# Docker Learn

**Terminology**

- Image - contains the code, OS, configurations, and dependencies (artifacts)
  - image alone is nothing, need container to run it
  - docker pull <image>, docker run <image>
  - not running
- Container - contains dependencies, configurations (like .env, ports), and also virtual file system
  - container are stored in repository like DockerHub (but everything is image)
  - is own isolated OS layer
  - running
- Tag - version of the image
- detached mode - running docker in the background, can still use terminal
- build - converting the code into an image
- docker network - docker creates its own isolated network for containers (if same network, the containers can talk with each other directly with container name)
- docker compose - helps in running multiple docker containers easier

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/09e43348-83ee-426d-8c3f-9ed723dc883a/6e2a3a93-c10c-435b-b9bc-89bd2f97c065/image.png)

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/09e43348-83ee-426d-8c3f-9ed723dc883a/302de428-b780-474d-b626-7b659ad36ceb/image.png)

- Dockerfile
  - to create images
  - linux command executed is to create stuffs INSIDE the container, not on host
  - BUT `COPY` command is executed from the host
  - if changed the code in Dockerfile, must rebuild the image!
- Images are based on each other using `FROM` command (built on top of each other)

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/09e43348-83ee-426d-8c3f-9ed723dc883a/fefa6c0b-dcd3-4c94-83e7-84e294b9c9e6/image.png)

- Docker volumes - for data persistent by creating connections with 3 type of volumes
  - 1. host volumes - e.g. docker run -v /home/mount/data:/var/lib/mysql/data
  - 2. anonymous volumes - e.g. docker run -v /var/lib/mysql/data (host path will be generated by Docker automatically)
  - 3. named volumes (**best**) - e.g. docker run -v <volume name>:/var/lib/mysql/data (specify own path name)

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/09e43348-83ee-426d-8c3f-9ed723dc883a/474a3c21-a252-42d7-aa30-53694c8408df/image.png)

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/09e43348-83ee-426d-8c3f-9ed723dc883a/95318da8-e633-45c0-8e5e-5e5803a2d42c/image.png)

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/09e43348-83ee-426d-8c3f-9ed723dc883a/0bf8f4d0-f424-4c82-a48c-303582e31960/image.png)

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/09e43348-83ee-426d-8c3f-9ed723dc883a/22bceb5b-990e-4017-a666-3dbae6992e78/image.png)

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/09e43348-83ee-426d-8c3f-9ed723dc883a/a3e2c1e8-d9b0-4420-8a4e-c0d3e35410f9/image.png)

**Theories**

- OS has 2 layers:
  - 1. Kernel - communicates with the hardware (CPU, memory)
  - 2. Application - runs on the kernel layer
- Docker vs VM
  ![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/09e43348-83ee-426d-8c3f-9ed723dc883a/1c8d873d-b357-4c54-899f-bb9eb7501dfa/Untitled.png)
- Container port vs host port
  - the container port can be binded to the host port
  - can have duplicated port number for container **BUT NOT** port number for host

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/09e43348-83ee-426d-8c3f-9ed723dc883a/84e838f2-bd36-473f-aa3d-c5110d4aa403/image.png)

- Docker private container registry - can be created using AWS ECR
  - Each registry contains only an image - but it can have multiple different version tags

**Purpose**

- To help in these purposes below:
  - 1. application development - setting up new dev environment (e.g. in Mac, Windows, Linux)
  - 2. application deployment - pacjage the JAR, dependencies, and configurations
- Docker is to solve the different installation process on each OS env

**File systems**

- Dockerfile - the dockerfile to create images (must start with FROM <base image>)
- docker-compose.yml - the docker compose file (in .yml format, the indentation is important)
- .dockerignore - contains the file to be ignored for Docker when copying over

**Commands**

- Notably
  - `container id` - obtained through docker ps
  - `-d` - detached mode, can mix and match
  - `-p` - binding mode, can mix and match
  - `-e` - set environment variables
  - `-t` - to give images a tag
  - `--name <container name>` - create a name for the container
  - `--net <network name>` - run the container in the specified network
  - `<image name: version>` - can mix and match
- Basic commands
  - `docker pull <image name>` - to clone an image
  - `docker pull <image name:**version**>` - to clone an image in the version
  - `docker run -p<host port>:<container port> <image name:version>` - to bind the port and run container
  - `docker run <image name>` - to run the image in container (also, contains pull and start)
  - `docker run -d <image name>` - to run the image in container in detached mode
  - `docker stop <container id>` - to stop the running container
  - `docker start <container id>` - to start again the container
  - `docker build . -t <image name>` - to build an image
  - `docker images` - to view all images
  - `docker ps` - to list the running containers and images
  - `docker ps -a` - to show the running and stopped container - like a history
  - `docker network ls` - to list all the networks in docker
  - `docker network create <network name>` - to create a network
  - `docker rmi <image id>` - to remove the image
  - `docker tag` - to rename the tag
- Docker compose
  - `docker-compose -f <file name for .yml> up` - to start all the containers in yml file
  - `docker-compose -f <file name for .yml> down` - to stop all the containers in yml file
- Dockerfile commands
  - `docker build -t <tag name:version> .` - to build an image using Dockerfile, where it is located in curr directory
  - `FROM` - to create a base image for docker (must haves)
  - `ENV` - set the env variables
  - `COPY` - copy files into docker
  - `RUN` - execute linux commands
  - `CMD` - entry point of Dockerfile, like starting the app
  - Differences: `RUN` and `CMD` - can have multiple RUN but only one CMD command
- Debugging
  - `docker logs <container id/name>` - to view the logs of the container, can be used to check if container started successfully
  - `docker exec -it <container id/name> /bin/bash or /bin/sh` - get into terminal of running container, can use to check files, print env vars
  - `exit` - to exit the interactive terminal above
  - `env` - to list all environment variables in the terminal
- Pushing to private docker registry
  ![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/09e43348-83ee-426d-8c3f-9ed723dc883a/09396270-6026-4d83-b419-e72b12475520/image.png)
- Extras
  - `\` - symbol used for multiple line commands

**Overall flows**

- AWS ECR is to store our own images built using Dockerfile; Docker Hub contains all the public images

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/09e43348-83ee-426d-8c3f-9ed723dc883a/a68f38d8-b228-465a-9c43-8f3b241932fb/image.png)

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/09e43348-83ee-426d-8c3f-9ed723dc883a/e136f339-8769-45a5-bd68-f3e64ee5ba42/image.png)

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/09e43348-83ee-426d-8c3f-9ed723dc883a/4cd33e78-604d-466e-b80b-c70fde8d8056/image.png)
